#include <Stepper.h>

const int stepsPerRevolution = 200;  // change this to fit the number of steps per revolution for your motor

// initialize the stepper library for the stepper library
const int motorPins[2][4] = {
  {2, 3, 4, 5}, //Motor 1 pins
  {6, 7, 8, 9} // Motor 2 pins
};

Stepper motors[2] = {
  Stepper(stepsPerRevolution, motorPins[0][0], motorPins[0][1], motorPins[0][2], motorPins[0][3]),
  Stepper(stepsPerRevolution, motorPins[1][0], motorPins[1][1], motorPins[1][2], motorPins[1][3]),
};

int speed = 0;
bool speedSet = false;

void setup() {
  Serial.begin(9600);
}

void loop() {
  // read the speed value from the serial input if it hasn't been set yet:
  if (!speedSet && Serial.available() > 0) {
    speed = Serial.parseInt(); // Read the integer value from serial input
    if (speed <= 200 && speed > 0) {
      speedSet = true; // Set the flag to indicate that speed has been set
      Serial.print("Speed is set to: ");
      Serial.println(speed);
      for (int i = 0; i < 2; i++) {
        motors[i].setSpeed(speed);
      }
    }
  }
  
  if (speedSet) {
    for (int i = 0; i < 2; i++) {
      backward(i);
      delay(1000);
      forward(i);
      delay(1000);
    }
  }
}

  void stop(int motorIndex) {
    motors[motorIndex].step(0);
}

  void forward(int motorIndex) {
    motors[motorIndex].step(stepsPerRevolution);
}

  void backward(int motorIndex) {
    motors[motorIndex].step(-stepsPerRevolution);
}
